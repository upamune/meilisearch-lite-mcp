# Meilisearch ハイブリッド検索 MCP プロジェクト

このプロジェクトは、Meilisearch と Multi-Cloud Provider (MCP) フレームワークを組み合わせたハイブリッド検索ソリューションの実装を目指します。

## 概要

検索機能は、現代のアプリケーションにおいて不可欠な要素です。ユーザーは高速かつ関連性の高い検索結果を期待しています。Meilisearch は、そのスピードと使いやすさで知られるオープンソースの検索エンジンです。一方、MCP は、複数のクラウドサービスやローカルリソースを抽象化し、統一されたインターフェースを提供するためのフレームワーク（このプロジェクトで開発中）です。

このプロジェクトでは、Markdown ファイルなどのドキュメントを効率的にインデックス化し、Meilisearch を利用してキーワード検索とセマンティック検索（ベクトル検索）を組み合わせたハイブリッド検索を実現します。

### 主な機能

- **Markdown ファイルの分割**: ドキュメントを意味のあるチャンクに分割します。
- **インデックス作成**: 分割されたチャンクを Meilisearch にインデックスします。
- **ハイブリッド検索 API**: キーワード検索とベクトル検索の結果を統合して返します。

## 技術スタック

- **Go**: バックエンド処理と MCP サーバーの実装に使用します。
- **Meilisearch**: 高速な検索エンジンとして利用します。
- **tiktoken**: テキストのトークン化に使用します。
- **goldmark**: Markdown のパースに使用します。
- **kagome**: 日本語の形態素解析と文分割に使用します。

### コード例 (Go)

以下は、Go 言語で簡単な HTTP サーバーを起動する例です。

```go
package main

import (
	"fmt"
	"log"
	"net/http"
)

func handler(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintf(w, "こんにちは、%s！", r.URL.Path[1:])
}

func main() {
	http.HandleFunc("/", handler)
	log.Println("サーバーをポート 8080 で起動します...")
	log.Fatal(http.ListenAndServe(":8080", nil))
}
```

## ドキュメントのチャンク化

ドキュメントを適切にチャンク化することは、特にベクトル検索において重要です。大きすぎるチャンクは情報の密度を薄め、小さすぎるチャンクは文脈を失わせる可能性があります。

この `splitter` パッケージでは、以下の戦略を採用しています。

1.  **構造に基づいた分割**: Markdown の見出し構造 (`#`, `##` など) を利用して、大きなセクションを区切ります。
2.  **コードブロックの分離**: コードブロックは独立したチャンクとして扱います。これは、自然言語とコードでベクトル表現が異なるためです。
3.  **文単位の分割**: テキスト部分は、文（特に日本語の場合は句点「。」や感嘆符「！」など）で分割します。
4.  **トークン数に基づく結合と再分割**: 文単位で分割した後、指定された最大トークン数 (`chunkSize`) を超えないように、複数の文を結合します。長すぎる文はさらに分割される可能性がありますが、現在の実装では主に結合が中心です。オーバーラップ (`chunkOverlap`) も考慮されますが、実装詳細は進行中です。

### コード例 (Python)

これは、Python でリスト内の数値を合計する簡単な関数です。

```python
def sum_list(numbers):
  """リスト内の数値の合計を計算する関数"""
  total = 0
  for number in numbers:
    # Check if the item is a number (int or float)
    if isinstance(number, (int, float)):
      total += number
    else:
      print(f"警告: リスト内の非数値要素は無視されました: {number}")
  return total

# Example usage
my_list = [1, 2, 3, 'a', 4.5, 5]
result = sum_list(my_list)
print(f"リストの合計: {result}")
```

## 今後の課題

- **ベクトル生成**: チャンク化されたテキストからベクトル埋め込みを生成する機能。
- **Meilisearch インテグレーション**: Meilisearch Go クライアントを使用したインデックス作成と検索の実装。
- **API 設計**: MCP サーバーの API エンドポイントの設計と実装。
- **テストの拡充**: より多くのエッジケースをカバーするテストケースの追加。

このドキュメント自体も、開発中の `splitter` によってチャンク化され、検索対象となる予定です。継続的な改善にご期待ください。
